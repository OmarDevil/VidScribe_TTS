Index: src/downloadtool.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import time\r\nimport os\r\nimport yt_dlp\r\nfrom selenium import webdriver\r\nfrom selenium.webdriver.common.by import By\r\nfrom selenium.webdriver.chrome.service import Service\r\nfrom webdriver_manager.chrome import ChromeDriverManager\r\n\r\n# Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ØªØµÙØ­ Chrome\r\noptions = webdriver.ChromeOptions()\r\noptions.add_argument(\"--headless\")  # ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ØªØµÙØ­ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©\r\noptions.add_argument(\"--disable-gpu\")\r\noptions.add_argument(\"--no-sandbox\")\r\noptions.add_argument(\"--disable-dev-shm-usage\")\r\n\r\n# ØªØ´ØºÙŠÙ„ WebDriver\r\ndriver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=options)\r\n\r\n\r\ndef search_tiktok_videos(keyword, max_results=5):\r\n    search_url = f\"https://www.tiktok.com/search?q={keyword}\"\r\n    driver.get(search_url)\r\n    time.sleep(5)  # Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©\r\n\r\n    video_links = []\r\n    videos = driver.find_elements(By.XPATH, \"//a[contains(@href, '/video/')]\")\r\n\r\n    for video in videos[:max_results]:\r\n        link = video.get_attribute(\"href\")\r\n        if link and link not in video_links:\r\n            video_links.append(link)\r\n\r\n    return video_links\r\n\r\n\r\ndef download_tiktok_video(url):\r\n    ydl_opts = {\r\n        'outtmpl': '%(title)s.%(ext)s',  # ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†\r\n        'format': 'best',  # ØªØ­Ù…ÙŠÙ„ Ø¨Ø£ÙØ¶Ù„ Ø¬ÙˆØ¯Ø© Ù…ØªØ§Ø­Ø©\r\n        'cookies': 'cookies.txt'  # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ² Ù„ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ù…Ø§ÙŠØ©\r\n    }\r\n\r\n    try:\r\n        with yt_dlp.YoutubeDL(ydl_opts) as ydl:\r\n            ydl.download([url])\r\n    except Exception as e:\r\n        print(f\"âš \uFE0F ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: {url}\\nØ§Ù„Ø³Ø¨Ø¨: {e}\")\r\n\r\n\r\n# Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†ØµÙŠØ© Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ \"Key Words\"\r\nkeywords_dir = \"Key Words\"\r\nkeywords_files = [f for f in os.listdir(keywords_dir) if f.endswith(\".txt\")]\r\n\r\nkeywords = []\r\nfor file_name in keywords_files:\r\n    file_path = os.path.join(keywords_dir, file_name)\r\n    try:\r\n        with open(file_path, \"r\", encoding=\"utf-8\") as file:\r\n            keywords.extend([line.strip() for line in file if line.strip()])\r\n    except FileNotFoundError:\r\n        print(f\"ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ù: {file_name}\")\r\n\r\n# ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„\r\nif keywords:\r\n    for keyword in keywords:\r\n        print(f\"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„ÙƒÙ„Ù…Ø©: {keyword}\")\r\n        video_urls = search_tiktok_videos(keyword)\r\n\r\n        if video_urls:\r\n            print(\"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª...\")\r\n            for url in video_urls:\r\n                download_tiktok_video(url)\r\n            print(\"ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!\")\r\n        else:\r\n            print(\"Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª.\")\r\nelse:\r\n    print(\"Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© ÙÙŠ Ø£ÙŠ Ù…Ù„Ù Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬Ù„Ø¯.\")\r\n\r\n# Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ØªØµÙØ­\r\ndriver.quit()\r\n\r\n# ØªØ­Ø¯ÙŠØ« yt-dlp ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ TikTok\r\nos.system(\"yt-dlp -U\")
===================================================================
diff --git a/src/downloadtool.py b/src/downloadtool.py
--- a/src/downloadtool.py	(revision 587951e8779a6a43c7cc83c9f54550507f81d3d8)
+++ b/src/downloadtool.py	(date 1741833561045)
@@ -1,83 +1,91 @@
-import time
 import os
+import re
+import time
 import yt_dlp
 from selenium import webdriver
-from selenium.webdriver.common.by import By
 from selenium.webdriver.chrome.service import Service
+from selenium.webdriver.common.by import By
+from selenium.webdriver.common.keys import Keys
+from selenium.webdriver.chrome.options import Options
+from selenium.webdriver.support.ui import WebDriverWait
+from selenium.webdriver.support import expected_conditions as EC
 from webdriver_manager.chrome import ChromeDriverManager
 
-# Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ØªØµÙØ­ Chrome
-options = webdriver.ChromeOptions()
-options.add_argument("--headless")  # ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ØªØµÙØ­ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
-options.add_argument("--disable-gpu")
-options.add_argument("--no-sandbox")
-options.add_argument("--disable-dev-shm-usage")
-
-# ØªØ´ØºÙŠÙ„ WebDriver
-driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=options)
 
+def sanitize_filename(filename):
+    filename = re.sub(r'[^a-zA-Z0-9Ø£-ÙŠ ]', '', filename)  # Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø®Ø§ØµØ©
+    return filename[:50]  # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù
 
-def search_tiktok_videos(keyword, max_results=5):
-    search_url = f"https://www.tiktok.com/search?q={keyword}"
-    driver.get(search_url)
-    time.sleep(5)  # Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
 
-    video_links = []
-    videos = driver.find_elements(By.XPATH, "//a[contains(@href, '/video/')]")
-
-    for video in videos[:max_results]:
-        link = video.get_attribute("href")
-        if link and link not in video_links:
-            video_links.append(link)
-
-    return video_links
-
-
-def download_tiktok_video(url):
-    ydl_opts = {
-        'outtmpl': '%(title)s.%(ext)s',  # ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
-        'format': 'best',  # ØªØ­Ù…ÙŠÙ„ Ø¨Ø£ÙØ¶Ù„ Ø¬ÙˆØ¯Ø© Ù…ØªØ§Ø­Ø©
-        'cookies': 'cookies.txt'  # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ² Ù„ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ù…Ø§ÙŠØ©
-    }
-
-    try:
-        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
-            ydl.download([url])
-    except Exception as e:
-        print(f"âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: {url}\nØ§Ù„Ø³Ø¨Ø¨: {e}")
+def download_tiktok_video(url, retries=3):
+    for attempt in range(retries):
+        try:
+            ydl_opts = {
+                'outtmpl': f'%(title)s.%(ext)s',
+                'quiet': False,
+                'cookiefile': 'cookies.txt',
+                'ignoreerrors': True,
+            }
+            with yt_dlp.YoutubeDL(ydl_opts) as ydl:
+                info_dict = ydl.extract_info(url, download=False)
+                if not info_dict:
+                    print(f'âš ï¸ ØªØ¹Ø°Ø± Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„ÙÙŠØ¯ÙŠÙˆ: {url}')
+                    return
+                filename = sanitize_filename(info_dict.get('title', 'video'))
+                ydl_opts['outtmpl'] = filename + '.%(ext)s'
+                with yt_dlp.YoutubeDL(ydl_opts) as ydl:
+                    ydl.download([url])
+            return
+        except Exception as e:
+            print(f'âš ï¸ Ù…Ø­Ø§ÙˆÙ„Ø© {attempt + 1} ÙØ´Ù„Øª: {e}')
+            time.sleep(5)
+    print(f'âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø¹Ø¯ {retries} Ù…Ø­Ø§ÙˆÙ„Ø§Øª: {url}')
 
 
-# Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†ØµÙŠØ© Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ "Key Words"
-keywords_dir = "Key Words"
-keywords_files = [f for f in os.listdir(keywords_dir) if f.endswith(".txt")]
+def search_tiktok(keyword):
+    options = Options()
+    options.add_argument('--headless')
+    options.add_argument('--disable-gpu')
+    options.add_argument('--no-sandbox')
+    driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=options)
+    driver.get('https://www.tiktok.com/')
+    time.sleep(5)
 
-keywords = []
-for file_name in keywords_files:
-    file_path = os.path.join(keywords_dir, file_name)
     try:
-        with open(file_path, "r", encoding="utf-8") as file:
-            keywords.extend([line.strip() for line in file if line.strip()])
-    except FileNotFoundError:
-        print(f"ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ù: {file_name}")
+        search_box = WebDriverWait(driver, 10).until(
+            EC.element_to_be_clickable((By.NAME, 'q'))
+        )
+        driver.execute_script("arguments[0].click();", search_box)
+        search_box.send_keys(keyword)
+        search_box.send_keys(Keys.RETURN)
+    except Exception as e:
+        print(f'âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«: {e}')
+        driver.quit()
+        return []
+
+    time.sleep(5)
+    links = driver.find_elements(By.CSS_SELECTOR, 'a[href*="/video/"]')
+    video_urls = [link.get_attribute('href') for link in links]
+    driver.quit()
+    return video_urls[:5]  # ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ 5 Ù†ØªØ§Ø¦Ø¬ ÙÙ‚Ø·
 
-# ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„
-if keywords:
-    for keyword in keywords:
-        print(f"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„ÙƒÙ„Ù…Ø©: {keyword}")
-        video_urls = search_tiktok_videos(keyword)
-
-        if video_urls:
-            print("Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª...")
-            for url in video_urls:
-                download_tiktok_video(url)
-            print("ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!")
-        else:
-            print("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª.")
-else:
-    print("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© ÙÙŠ Ø£ÙŠ Ù…Ù„Ù Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬Ù„Ø¯.")
+
+def main():
+    keywords_folder = 'Key Words'
+    if not os.path.exists(keywords_folder):
+        print(f'âŒ Ø§Ù„Ù…Ø¬Ù„Ø¯ {keywords_folder} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!')
+        return
+    for file in os.listdir(keywords_folder):
+        if file.endswith('.txt'):
+            with open(os.path.join(keywords_folder, file), 'r', encoding='utf-8') as f:
+                keywords = [line.strip() for line in f if line.strip()]
+            for keyword in keywords:
+                print(f'ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: {keyword}')
+                video_urls = search_tiktok(keyword)
+                for url in video_urls:
+                    print(f'â¬‡ï¸ ØªØ­Ù…ÙŠÙ„: {url}')
+                    download_tiktok_video(url)
 
-# Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ØªØµÙØ­
-driver.quit()
 
-# ØªØ­Ø¯ÙŠØ« yt-dlp ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ TikTok
-os.system("yt-dlp -U")
\ No newline at end of file
+if __name__ == '__main__':
+    main()
